const STRINGS = {
  en: {
    heroTitle: "Sustainability Through the Ages",
    heroSub:
      "Explore Intel's journey through time, discovering how our commitment to innovation has shaped a more sustainable future for technology and our planet.",
    hintText: "Scroll to view timeline | Hover over cards to learn more!",

    m1968Title: "Intel Founded",
    m1968Body:
      "Robert Noyce and Gordon Moore rename the newly formed company NM Electronics to Intel Corporation, laying the foundation for decades of technological innovation.",
    m1971Title: "First Microprocessor",
    m1971Body:
      "Intel debuts the 4004, the world's first commercial microprocessor, igniting the microprocessor revolution and propelling the future of computing devices.",
    m1978Title: "8086 Processor",
    m1978Body:
      "Launch of the 8086 processor, establishing the x86 architecture that drives countless PCs and servers in the modern era.",
    m1985Title: "386 Processor",
    m1985Body:
      "Intel introduces the 386 processor with 32-bit architecture, ushering in a new era of performance and multitasking for personal computers.",
    m2020Title: "RISE Strategy",
    m2020Body:
      "Intel launches its RISE (Responsible, Inclusive, Sustainable, Enabling) strategy and 2030 goals, aiming to drive industry-wide progress on climate action, water stewardship, and waste reduction.",

    impactTitle: "How Intel Drives Sustainable Impact",
    impactSubtitle:
      "Three pillars that help reduce emissions, protect resources, and design for the future.",
    col1Title: "Energy Efficiency",
    col1Body:
      "Improving performance per watt and reducing energy usage across products and operations.",
    col2Title: "Water Stewardship",
    col2Body:
      "Conserving and restoring water resources through smarter processes and partnerships.",
    col3Title: "Circular Design",
    col3Body:
      "Reducing waste by rethinking materials, packaging, and end-of-life recovery.",
    learnMore: "Learn More →",

    newsletterTitle: "Subscribe to Intel’s Sustainability Newsletter",
    newsletterBody:
      "Get updates on goals, progress, and stories from across Intel’s sustainability journey.",
    emailLabel: "Email address",
    emailHelp: "We’ll never share your email. Unsubscribe anytime.",
    subscribeBtn: "Subscribe",

    rights: "All rights reserved.",
    privacy: "Privacy Policy",
    terms: "Terms of Use",
    contact: "Contact",
  },

  fr: {
    heroTitle: "Durabilité à travers les âges",
    heroSub:
      "Explorez le parcours d’Intel à travers le temps et découvrez comment notre engagement envers l’innovation a façonné un avenir plus durable pour la technologie et notre planète.",
    hintText: "Faites défiler pour voir la chronologie | Survolez les cartes pour en savoir plus !",

    m1968Title: "Fondation d’Intel",
    m1968Body:
      "Robert Noyce et Gordon Moore renommèrent NM Electronics en Intel Corporation, posant les bases de décennies d’innovation technologique.",
    m1971Title: "Premier microprocesseur",
    m1971Body:
      "Intel lance le 4004, le premier microprocesseur commercial au monde, déclenchant la révolution des microprocesseurs.",
    m1978Title: "Processeur 8086",
    m1978Body:
      "Lancement du 8086, établissant l’architecture x86 qui alimente de nombreux PC et serveurs modernes.",
    m1985Title: "Processeur 386",
    m1985Body:
      "Intel introduit le 386 en 32 bits, ouvrant une nouvelle ère de performances et de multitâche.",
    m2020Title: "Stratégie RISE",
    m2020Body:
      "Intel lance sa stratégie RISE et ses objectifs 2030 afin de faire progresser l’action climatique, la gestion de l’eau et la réduction des déchets.",

    impactTitle: "Comment Intel favorise un impact durable",
    impactSubtitle:
      "Trois piliers pour réduire les émissions, protéger les ressources et concevoir pour l’avenir.",
    col1Title: "Efficacité énergétique",
    col1Body:
      "Améliorer la performance par watt et réduire la consommation d’énergie des produits et des opérations.",
    col2Title: "Gestion de l’eau",
    col2Body:
      "Préserver et restaurer les ressources en eau grâce à des procédés plus intelligents et des partenariats.",
    col3Title: "Conception circulaire",
    col3Body:
      "Réduire les déchets en repensant les matériaux, l’emballage et la récupération en fin de vie.",
    learnMore: "En savoir plus →",

    newsletterTitle: "S’abonner à la newsletter Durabilité d’Intel",
    newsletterBody:
      "Recevez des mises à jour sur les objectifs, les progrès et les initiatives durables d’Intel.",
    emailLabel: "Adresse e-mail",
    emailHelp: "Nous ne partagerons jamais votre e-mail. Désabonnement à tout moment.",
    subscribeBtn: "S’abonner",

    rights: "Tous droits réservés.",
    privacy: "Politique de confidentialité",
    terms: "Conditions d’utilisation",
    contact: "Contact",
  },

  ar: {
    heroTitle: "الاستدامة عبر العصور",
    heroSub:
      "استكشف رحلة إنتل عبر الزمن وتعرّف على كيف ساهم التزامنا بالابتكار في بناء مستقبل أكثر استدامة للتقنية وكوكبنا.",
    hintText: "مرّر لعرض الخط الزمني | مرّر فوق البطاقات لمعرفة المزيد!",

    m1968Title: "تأسيس إنتل",
    m1968Body:
      "قام روبرت نويس وجوردون مور بإعادة تسمية NM Electronics إلى Intel Corporation، مما وضع الأساس لعقود من الابتكار.",
    m1971Title: "أول معالج دقيق",
    m1971Body:
      "أطلقت إنتل المعالج 4004، أول معالج دقيق تجاري في العالم، مما أشعل ثورة الحوسبة الحديثة.",
    m1978Title: "معالج 8086",
    m1978Body:
      "إطلاق معالج 8086 الذي أسس معمارية x86 المستخدمة في العديد من الحواسيب والخوادم الحديثة.",
    m1985Title: "معالج 386",
    m1985Body:
      "قدّمت إنتل معالج 386 بمعمارية 32-بت، مما فتح باباً لأداء أعلى وتعدد مهام أفضل.",
    m2020Title: "استراتيجية RISE",
    m2020Body:
      "أطلقت إنتل استراتيجية RISE وأهداف 2030 لدعم العمل المناخي وإدارة المياه وتقليل النفايات.",

    impactTitle: "كيف تدعم إنتل الاستدامة",
    impactSubtitle:
      "ثلاثة محاور تساعد على تقليل الانبعاثات وحماية الموارد وبناء مستقبل أفضل.",
    col1Title: "كفاءة الطاقة",
    col1Body:
      "تحسين الأداء لكل واط وتقليل استهلاك الطاقة عبر المنتجات والعمليات.",
    col2Title: "إدارة المياه",
    col2Body:
      "حماية موارد المياه واستعادتها عبر عمليات أكثر ذكاءً وشراكات فعّالة.",
    col3Title: "تصميم دائري",
    col3Body:
      "تقليل النفايات عبر إعادة التفكير في المواد والتغليف واسترجاع المنتجات بعد الاستخدام.",
    learnMore: "اعرف المزيد ←",

    newsletterTitle: "اشترك في نشرة إنتل للاستدامة",
    newsletterBody:
      "احصل على تحديثات حول الأهداف والتقدم وقصص الاستدامة لدى إنتل.",
    emailLabel: "البريد الإلكتروني",
    emailHelp: "لن نشارك بريدك الإلكتروني. يمكنك إلغاء الاشتراك في أي وقت.",
    subscribeBtn: "اشتراك",

    rights: "جميع الحقوق محفوظة.",
    privacy: "سياسة الخصوصية",
    terms: "شروط الاستخدام",
    contact: "تواصل معنا",
  },
};

function isRTL(lang) {
  return lang === "ar";
}

function setBootstrapDir(lang) {
  const rtlLink = document.getElementById("bs-rtl");
  if (!rtlLink) return;
  rtlLink.disabled = !isRTL(lang);
}

/* ---- IMPORTANT FIX: prevents MutationObserver infinite loop ---- */
let isApplying = false;

function applyLang(lang) {
  const dict = STRINGS[lang] || STRINGS.en;

  isApplying = true;

  // Update html lang
  if (document.documentElement.lang !== lang) {
    document.documentElement.lang = lang;
  }

  // Update dir ONLY if different (prevents loops)
  const desiredDir = isRTL(lang) ? "rtl" : "ltr";
  if (document.documentElement.dir !== desiredDir) {
    document.documentElement.dir = desiredDir;
  }

  // Toggle Bootstrap RTL stylesheet
  setBootstrapDir(lang);

  // Replace all translated text
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    if (dict[key]) el.textContent = dict[key];
  });

  // Optional: better Arabic font
  if (lang === "ar") document.body.style.fontFamily = "Tahoma, Arial, sans-serif";
  else document.body.style.fontFamily = "";

  // release guard after DOM updates finish
  setTimeout(() => {
    isApplying = false;
  }, 0);
}

/* LevelUp: detect external language changes (Google Translate, etc.) */
function observeLangChanges() {
  const obs = new MutationObserver(() => {
    // Ignore changes that we caused ourselves
    if (isApplying) return;

    const lang = document.documentElement.lang || "en";
    const desiredDir = isRTL(lang) ? "rtl" : "ltr";

    // Only update if needed
    if (document.documentElement.dir !== desiredDir) {
      document.documentElement.dir = desiredDir;
    }

    setBootstrapDir(lang);
  });

  obs.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ["lang", "dir"],
  });
}

document.addEventListener("DOMContentLoaded", () => {
  // Footer year
  const year = document.getElementById("year");
  if (year) year.textContent = new Date().getFullYear();

  // Dropdown switching
  const sel = document.getElementById("langSelect");
  if (sel) {
    sel.addEventListener("change", (e) => applyLang(e.target.value));
    applyLang(sel.value);
  } else {
    applyLang(document.documentElement.lang || "en");
  }

  observeLangChanges();
});